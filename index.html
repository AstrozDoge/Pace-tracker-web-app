<!DOCTYPE html>
<html>
<head>
  <title>Pace Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    input, button { margin: 10px; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Pace Tracker</h1>

  <label>Distance Goal (km): <input id="distanceGoal" type="number" step="0.1"></label><br>
  <label>Time Goal (minutes): <input id="timeGoal" type="number" step="1"></label><br>
  <button onclick="startRun()">Start Run</button>

  <h3 id="status">Status: Not started</h3>
  <p id="speedInfo"></p>
  <p id="distanceInfo"></p>
  <p id="paceInfo"></p>

  <script>
    let watchId;
    let startTime;
    let totalDistance = 0;
    let lastCoords = null;
    let intervalId;
    let goalTime, goalDistance, targetSpeed;
    let timeAnnouncements = [0.25, 0.5, 0.75];
    let consistentTime = 0;
    let lastSpeed = null;

    function speak(msg) {
      const utterance = new SpeechSynthesisUtterance(msg);
      speechSynthesis.speak(utterance);
    }

    function startRun() {
      totalDistance = 0;
      lastCoords = null;
      startTime = Date.now();
      consistentTime = 0;

      const d = parseFloat(document.getElementById('distanceGoal').value);
      const t = parseFloat(document.getElementById('timeGoal').value);

      if (!d || !t) return alert("Please enter both distance and time goals.");

      goalDistance = d * 1000; // in meters
      goalTime = t * 60; // in seconds
      targetSpeed = goalDistance / goalTime;

      document.getElementById('status').innerText = "Status: Running";

      if (!navigator.geolocation) {
        alert("Geolocation not supported.");
        return;
      }

      speak("Run started. Keep your pace steady!");

      watchId = navigator.geolocation.watchPosition(updatePosition, () => {
        alert("Unable to track location.");
      }, { enableHighAccuracy: true });

      intervalId = setInterval(checkProgress, 10000);
    }

    function updatePosition(pos) {
      const { latitude, longitude, speed } = pos.coords;

      if (lastCoords) {
        const dist = getDistanceFromLatLonInMeters(lastCoords.lat, lastCoords.lon, latitude, longitude);
        totalDistance += dist;
      }

      lastCoords = { lat: latitude, lon: longitude };

      let currentSpeed = speed || 0;
      lastSpeed = currentSpeed;

      document.getElementById("speedInfo").innerText = `Current Speed: ${currentSpeed.toFixed(2)} m/s`;
      document.getElementById("distanceInfo").innerText = `Distance Run: ${totalDistance.toFixed(1)} m`;
      document.getElementById("paceInfo").innerText = `Target Speed: ${targetSpeed.toFixed(2)} m/s`;

      if (totalDistance >= goalDistance) {
        endRun();
      }
    }

    function checkProgress() {
      const timeElapsed = (Date.now() - startTime) / 1000;
      const pacePercent = totalDistance / goalDistance;

      // Time-based motivation
      for (let i = 0; i < timeAnnouncements.length; i++) {
        if (pacePercent >= timeAnnouncements[i]) {
          const msg = `You're ${timeAnnouncements[i]
